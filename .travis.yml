language: cpp
dist: trusty

matrix:
  include:
    # Linux C++14 Build
    - os: linux
      compiler: gcc
      env: COMPILER=g++-5 BUILD=Debug STANDARD=14 ASAN=OFF TSAN=OFF
      addons:
        apt:
          update: true
          sources: ['ubuntu-toolchain-r-test']
          packages: [g++-5, valgrind]

    - os: linux
      compiler: gcc
      env: COMPILER=g++-5 BUILD=Release STANDARD=14 ASAN=OFF TSAN=OFF
      addons:
        apt:
          update: true
          sources: ['ubuntu-toolchain-r-test']
          packages: [g++-5, valgrind]

    # Linux C++17 Build
    - os: linux
      compiler: gcc
      env: COMPILER=g++-9 BUILD=Debug STANDARD=17 ASAN=OFF TSAN=OFF
      addons:
        apt:
          update: true
          sources: ['ubuntu-toolchain-r-test']
          packages: [g++-9, valgrind]

    - os: linux
      compiler: gcc
      env: COMPILER=g++-9 BUILD=Release STANDARD=17 ASAN=OFF TSAN=OFF
      addons:
        apt:
          update: true
          sources: ['ubuntu-toolchain-r-test']
          packages: [g++-9, valgrind]

install:
  - wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
  - sudo apt-get -qq update
  - sudo apt-get install -y libgtest-dev cmake
  - sudo pip install codecov

before_script:
  - if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then export CXX=${COMPILER}; fi
  - ${CXX} --version
  - cmake --version

script:
  - cd ${TRAVIS_BUILD_DIR}
  - mkdir -p build && cd build
  - |
    cmake .. \
      -DCMAKE_BUILD_TYPE=$BUILD \
      -DCMAKE_CXX_STANDARD=$STANDARD \
      -DQUILL_SANITIZE_ADDRESS=$ASAN \
      -DQUILL_SANITIZE_THREAD=$TSAN \
      -DQUILL_BUILD_TESTS=ON \
      -DQUILL_BUILD_EXAMPLES=ON
  - make VERBOSE=1 -j2
  - ctest --verbose

branches:
  only:
    - master

notifications:
  email: false